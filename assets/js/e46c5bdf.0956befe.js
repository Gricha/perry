"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2862],{69190(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"configuration/scripts","title":"Scripts","description":"Run custom scripts after workspace starts. Scripts execute after file sync, so they can reference synced resources.","source":"@site/docs/configuration/scripts.md","sourceDirName":"configuration","slug":"/configuration/scripts","permalink":"/perry/docs/configuration/scripts","draft":false,"unlisted":false,"editUrl":"https://github.com/gricha/perry/tree/main/docs/docs/configuration/scripts.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4}}');var i=s(74848),c=s(28453);const t={sidebar_position:4},l="Scripts",o={},a=[{value:"Configuration",id:"configuration",level:2},{value:"Via config.json",id:"via-configjson",level:3},{value:"Via Web UI",id:"via-web-ui",level:3},{value:"Default Configuration",id:"default-configuration",level:2},{value:"Script Types",id:"script-types",level:2},{value:"Single Scripts",id:"single-scripts",level:3},{value:"Script Directories",id:"script-directories",level:3},{value:"Multiple Sources",id:"multiple-sources",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Default: Continue on Error",id:"default-continue-on-error",level:3},{value:"Strict Mode",id:"strict-mode",level:3},{value:"Execution Environment",id:"execution-environment",level:2},{value:"Common Use Cases",id:"common-use-cases",level:2},{value:"Install Project Tools",id:"install-project-tools",level:3},{value:"Configure Git",id:"configure-git",level:3},{value:"Create Symlinks",id:"create-symlinks",level:3},{value:"Start Background Services",id:"start-background-services",level:3},{value:"Path Expansion",id:"path-expansion",level:2},{value:"Apply Changes",id:"apply-changes",level:2},{value:"Debugging",id:"debugging",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"scripts",children:"Scripts"})}),"\n",(0,i.jsx)(n.p,{children:"Run custom scripts after workspace starts. Scripts execute after file sync, so they can reference synced resources."}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"via-configjson",children:"Via config.json"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "post_start": [\n      "~/.perry/userscripts",\n      "~/scripts/setup.sh"\n    ],\n    "fail_on_error": false\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"via-web-ui",children:"Via Web UI"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open ",(0,i.jsx)(n.a,{href:"http://localhost:7391",children:"http://localhost:7391"})]}),"\n",(0,i.jsx)(n.li,{children:"Go to Settings > Scripts"}),"\n",(0,i.jsx)(n.li,{children:"Add script paths or directories"}),"\n",(0,i.jsx)(n.li,{children:'Toggle "Stop on script error" if needed'}),"\n",(0,i.jsx)(n.li,{children:"Save"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"default-configuration",children:"Default Configuration"}),"\n",(0,i.jsx)(n.p,{children:"New installations include:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "post_start": ["~/.perry/userscripts"],\n    "fail_on_error": false\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"~/.perry/userscripts/"})," directory on your host to add startup scripts."]}),"\n",(0,i.jsx)(n.h2,{id:"script-types",children:"Script Types"}),"\n",(0,i.jsx)(n.h3,{id:"single-scripts",children:"Single Scripts"}),"\n",(0,i.jsx)(n.p,{children:"Point to a shell script file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "post_start": ["~/scripts/setup.sh"]\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The script must be executable (",(0,i.jsx)(n.code,{children:"chmod +x"}),")."]}),"\n",(0,i.jsx)(n.h3,{id:"script-directories",children:"Script Directories"}),"\n",(0,i.jsxs)(n.p,{children:["Point to a directory containing ",(0,i.jsx)(n.code,{children:".sh"})," files:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "post_start": ["~/.perry/userscripts"]\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["All ",(0,i.jsx)(n.code,{children:".sh"})," files in the directory execute in ",(0,i.jsx)(n.strong,{children:"sorted order"})," (alphabetical). Use numeric prefixes to control order:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"~/.perry/userscripts/\n  01-install-tools.sh\n  02-configure-git.sh\n  10-setup-project.sh\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Non-",(0,i.jsx)(n.code,{children:".sh"})," files are ignored."]}),"\n",(0,i.jsx)(n.h2,{id:"multiple-sources",children:"Multiple Sources"}),"\n",(0,i.jsx)(n.p,{children:"Combine scripts and directories:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "post_start": [\n      "~/.perry/userscripts",\n      "~/work/company-setup.sh",\n      "~/projects/tools"\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Scripts execute in array order."}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.h3,{id:"default-continue-on-error",children:"Default: Continue on Error"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "post_start": ["~/scripts/setup.sh"],\n    "fail_on_error": false\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"If a script fails, Perry logs a warning and continues with remaining scripts. Workspace starts normally."}),"\n",(0,i.jsx)(n.h3,{id:"strict-mode",children:"Strict Mode"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "post_start": ["~/scripts/setup.sh"],\n    "fail_on_error": true\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"If any script exits with non-zero status, workspace startup fails."}),"\n",(0,i.jsx)(n.h2,{id:"execution-environment",children:"Execution Environment"}),"\n",(0,i.jsx)(n.p,{children:"Scripts run:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["As the ",(0,i.jsx)(n.code,{children:"workspace"})," user"]}),"\n",(0,i.jsxs)(n.li,{children:["In the container's home directory (",(0,i.jsx)(n.code,{children:"/home/workspace"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"After file sync completes (synced files are available)"}),"\n",(0,i.jsx)(n.li,{children:"With access to configured environment variables"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,i.jsx)(n.h3,{id:"install-project-tools",children:"Install Project Tools"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# ~/.perry/userscripts/01-install-tools.sh\n\n# Install global npm packages\nnpm install -g typescript tsx\n\n# Install rust tools\ncargo install just\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configure-git",children:"Configure Git"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# ~/.perry/userscripts/02-git-config.sh\n\n# Set up git aliases not in .gitconfig\ngit config --global alias.st status\ngit config --global alias.co checkout\n"})}),"\n",(0,i.jsx)(n.h3,{id:"create-symlinks",children:"Create Symlinks"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# ~/.perry/userscripts/03-symlinks.sh\n\n# Link synced config directories\nln -sf ~/.synced-nvim ~/.config/nvim\nln -sf ~/.synced-tmux/.tmux.conf ~/.tmux.conf\n"})}),"\n",(0,i.jsx)(n.h3,{id:"start-background-services",children:"Start Background Services"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# ~/.perry/userscripts/99-services.sh\n\n# Start any background services needed\n# (Note: prefer using Docker services when possible)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"path-expansion",children:"Path Expansion"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"~"})," expands to home directory on host"]}),"\n",(0,i.jsx)(n.li,{children:"Scripts are copied to container and executed there"}),"\n",(0,i.jsx)(n.li,{children:"Absolute paths work as-is"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"apply-changes",children:"Apply Changes"}),"\n",(0,i.jsx)(n.p,{children:"Scripts run:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"When creating new workspaces"}),"\n",(0,i.jsx)(n.li,{children:"When starting stopped workspaces"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Scripts do ",(0,i.jsx)(n.strong,{children:"not"})," run when syncing (",(0,i.jsx)(n.code,{children:"perry sync"}),") - only file sync occurs."]}),"\n",(0,i.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,i.jsx)(n.p,{children:"Check script output in workspace logs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"perry logs myworkspace\n"})}),"\n",(0,i.jsx)(n.p,{children:"Or connect to the workspace and check manually:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"perry ssh myworkspace\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);