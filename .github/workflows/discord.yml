name: Discord Notifications

on:
  release:
    types: [published]
  pull_request:
    types: [closed]

jobs:
  notify-release:
    if: github.event_name == 'release'
    runs-on: ubuntu-latest
    steps:
      - name: Post to Discord
        run: |
          curl -X POST "${{ secrets.DISCORD_WEBHOOK }}" \
            -H "Content-Type: application/json" \
            -d @- << 'EOF'
          {
            "embeds": [{
              "title": "Perry ${{ github.event.release.tag_name }} Released",
              "url": "${{ github.event.release.html_url }}",
              "color": 5025616,
              "fields": [
                {
                  "name": "Install",
                  "value": "```\nbunx @gricha/perry@${{ github.event.release.tag_name }}\n```",
                  "inline": false
                }
              ]
            }]
          }
          EOF

  notify-pr-merged:
    if: github.event_name == 'pull_request' && github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Post to Discord
        run: |
          curl -X POST "${{ secrets.DISCORD_WEBHOOK }}" \
            -H "Content-Type: application/json" \
            -d @- << EOF
          {
            "embeds": [{
              "title": "PR #${{ github.event.pull_request.number }} merged",
              "description": "${{ github.event.pull_request.title }}",
              "url": "${{ github.event.pull_request.html_url }}",
              "color": 6695930
            }]
          }
          EOF
